<!DOCTYPE html>
<meta charset="utf-8">
<title>U.S. Baby Name Explorer</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<style>
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

.line {
  fill: none;
  stroke-width: 4px;
}

</style>
<body>

<center>
<br />

<div id="chart"></div>

<p>The <strong><font color="#CC6699">pink</font></strong> line shows the percentage for baby girls; the <strong><font color="#008AB8">blue</font></strong> line shows the percentage for baby boys.</p>

<form action="index.html" method="get">
	<input type="text" id="BabyName" name="BabyName"></input>
	<input type="submit" value="Explore">
</form>

<br />

<p><a href="" target="_blank" id="download_url">Download the data</a> for the current chart.</p>

<p>Records prior to 1940 are <a href="http://www.prooffreader.com/2014/08/sex-ratio-is-clearest-indicator-of-bias.html">estimates</a> and should be taken with a grain of salt.</p>

<p>Records after 1985 are based on Social Security records and are quite reliable.</p>

<table width="720px">
<tr>
<td align="left" width="33%">Code and analysis by <strong><a href="http://www.randalolson.com/">Randy Olson</a></strong></td>
<td align="center" width="33%"><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="CC.png" /></a></td>
<td align="right" width="33%">Data from <strong><a href="http://www.ssa.gov/oact/babynames/limits.html">SSA.gov</a></strong></td>
</tr>
</table>
</center>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
function plotName(name) {
	
	var http = new XMLHttpRequest();
    http.open('HEAD', "names/" + name.charAt(0) + "/" + name + ".txt", false);
    http.send();
    if (http.status == 404) {
    	window.alert("Sorry, \"" + name + "\" is not in the baby name database.");
    	window.location.replace("index.html");
    }
    
    var margin = {top: 40, right: 20, bottom: 30, left: 100},
    width = 600,
    height = 400;

	var parseDate = d3.time.format("%Y").parse;

	var x = d3.time.scale()
		.range([0, width]);

	var y = d3.scale.linear()
		.range([height, 0]);

	var color = d3.scale.ordinal().range(["#CC6699", "#008AB8"]);//.scale.category10();

	var xAxis = d3.svg.axis()
		.scale(x)
		.orient("bottom");

	var formatPercent = d3.format(".4%");

	var yAxis = d3.svg.axis()
		.scale(y)
		.orient("left")
		.tickFormat(formatPercent);

	var line = d3.svg.line()
		.interpolate("basis")
		.x(function(d) { return x(d.year); })
		.y(function(d) { return y(d.count); });

	var svg = d3.select("#chart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	d3.csv("names/" + name.charAt(0) + "/" + name + ".txt", function(error, data) {
	  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "year"; }));

	  data.forEach(function(d) {
		d.year = parseDate(d.year);
	  });

	  var names = color.domain().map(function(name) {
		return {
		  name: name,
		  values: data.map(function(d) {
			return {year: d.year, count: +d[name]};
		  })
		};
	  });

	  x.domain(d3.extent(data, function(d) { return d.year; }));

	  y.domain([0.0,
		d3.max(names, function(c) { return d3.max(c.values, function(v) { return v.count; }); })
	  ]);

	  svg.append("g")
		  .attr("class", "x axis")
		  .attr("transform", "translate(0," + height + ")")
		  .call(xAxis);

	  svg.append("g")
		  .attr("class", "y axis")
		  .call(yAxis)
		.append("text")
		  .attr("transform", "rotate(-90)")
		  /*.attr("y", -6)
		  .attr("dy", ".71em")*/
		  .attr("y", -100)
       	  .attr("x", -125)
       	  .attr("dy", "1em")
		  .style("text-anchor", "end")
		  .text("% of all babies given name");

	  var name_obj = svg.selectAll(".name")
		  .data(names)
		.enter().append("g")
		  .attr("class", "name");

	  name_obj.append("path")
		  .attr("class", "line")
		  .attr("d", function(d) { return line(d.values); })
		  .style("stroke", function(d) { return color(d.name); });
		  
	  svg.append("text")
	  	.attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")
        .style("font-size", "24px")
        .text("Popularity of the name \"" + name + "\" in the U.S.");
	});
}

function toTitleCase(str) {
    return str.replace(/\w\S*/g, function(txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
}

var name = "Randal";

if (window.location.href.indexOf("?BabyName=") > 0) {
	name = toTitleCase(window.location.href.split("?BabyName=")[1]);
}

document.getElementById("download_url").href = "names/" + name.charAt(0) + "/" + name + ".txt";

plotName(name);

function downloadData() {
	var name = "Randal";

	if (window.location.href.indexOf("?BabyName=") > 0) {
		name = toTitleCase(window.location.href.split("?BabyName=")[1]);
	}
	
	window.open("names/" + name.charAt(0) + "/" + name + ".txt");
}
</script>

</body>